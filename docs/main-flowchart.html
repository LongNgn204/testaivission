<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vision Coach - Flowcharts</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover,
        .nav-tab.active {
            background: white;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .flowchart-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .flowchart-section.active {
            display: block;
        }

        .flowchart-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .flowchart-section h2::before {
            content: '';
            display: block;
            width: 5px;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            overflow-x: auto;
            padding: 20px 0;
        }

        .description {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .description h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .description ul {
            list-style: none;
        }

        .description li {
            padding: 8px 0;
            color: #555;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .description li::before {
            content: '‚Üí';
            color: #667eea;
            font-weight: bold;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .flowchart-section {
                padding: 15px;
            }

            .nav-tab {
                padding: 10px 16px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üìä Vision Coach - Website Flowcharts</h1>
            <p>S∆° ƒë·ªì lu·ªìng ho·∫°t ƒë·ªông to√†n b·ªô ·ª©ng d·ª•ng</p>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('overview')">üèóÔ∏è Ki·∫øn Tr√∫c</button>
            <button class="nav-tab" onclick="showSection('auth')">üîê X√°c Th·ª±c</button>
            <button class="nav-tab" onclick="showSection('home')">üè† Trang Ch·ªß</button>
            <button class="nav-tab" onclick="showSection('tests')">üéØ Tests</button>
            <button class="nav-tab" onclick="showSection('ai')">ü§ñ AI Eva</button>
            <button class="nav-tab" onclick="showSection('data')">üíæ Data Flow</button>
            <button class="nav-tab" onclick="showSection('admin')">üë®‚Äçüíº Admin</button>
        </div>

        <!-- Overview Section -->
        <section id="overview" class="flowchart-section active">
            <h2>Ki·∫øn Tr√∫c T·ªïng Quan</h2>
            <div class="mermaid">
                flowchart TD
                subgraph Public["üåê Public Routes"]
                A[üè† Welcome Page<br>/] --> B[üîê Auth Page<br>/login]
                end

                B --> C{ƒêƒÉng nh·∫≠p<br>th√†nh c√¥ng?}
                C -->|‚ùå| B
                C -->|‚úÖ| D{ƒê√£ setup<br>routine?}

                D -->|Ch∆∞a| E[‚öôÔ∏è Setup Page<br>/setup]
                E --> F[AI t·∫°o<br>Weekly Routine]
                F --> G

                D -->|R·ªìi| G[üè† Home Page<br>/home]

                subgraph Protected["üîí Protected Routes"]
                G --> H[üìã 5 Vision Tests]
                G --> I[üìä History & Progress]
                G --> J[üè• Hospital Locator]
                G --> K[‚öôÔ∏è Settings]
                end

                subgraph AI["ü§ñ AI Assistant - Eva"]
                L[üí¨ Text Chat]
                M[üé§ Voice Chat]
                end

                G -.-> L
                G -.-> M

                subgraph Admin["üë®‚Äçüíº Admin Dashboard"]
                N[üìä Dashboard]
                O[üë• Users]
                P[üìã Records]
                Q[üìà Analytics]
                end

                style A fill:#e3f2fd
                style G fill:#c8e6c9
                style H fill:#fff9c4
                style L fill:#f3e5f5
                style N fill:#e8eaf6
            </div>

            <div class="description">
                <h3>üìù M√¥ t·∫£</h3>
                <ul>
                    <li><strong>Public Routes:</strong> Kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p - Welcome Page, Auth Page</li>
                    <li><strong>Protected Routes:</strong> C·∫ßn ƒëƒÉng nh·∫≠p - T·∫•t c·∫£ t√≠nh nƒÉng ch√≠nh</li>
                    <li><strong>AI Eva:</strong> Tr·ª£ l√Ω AI lu√¥n floating s·∫µn s√†ng h·ªó tr·ª£</li>
                    <li><strong>Admin:</strong> Qu·∫£n l√Ω ng∆∞·ªùi d√πng v√† d·ªØ li·ªáu test</li>
                </ul>
            </div>
        </section>

        <!-- Auth Section -->
        <section id="auth" class="flowchart-section">
            <h2>Lu·ªìng X√°c Th·ª±c</h2>
            <div class="mermaid">
                flowchart TD
                A[üè† Welcome Page] --> B{Click B·∫Øt ƒë·∫ßu?}
                B -->|Yes| C[üìù Auth Page]

                C --> D{C√≥ t√†i kho·∫£n<br>ƒë√£ l∆∞u?}
                D -->|C√≥| E[üìã Danh s√°ch TK]
                D -->|Kh√¥ng| F[üìù Form m·ªõi]

                E --> G{Ch·ªçn TK c≈©?}
                G -->|C√≥| H[Auto-fill]
                G -->|Kh√¥ng| F

                H --> I
                F --> I[Nh·∫≠p Name/Phone/Age]

                I --> J{Validate?}
                J -->|‚ùå L·ªói| K[Hi·ªán l·ªói]
                K --> I

                J -->|‚úÖ OK| L[üì° API Login]
                L --> M{Th√†nh c√¥ng?}

                M -->|‚ùå| N[L·ªói API]
                N --> I

                M -->|‚úÖ| O[üíæ L∆∞u Token]
                O --> P{ƒê√£ Setup?}

                P -->|Ch∆∞a| Q[‚öôÔ∏è Setup Page]
                P -->|R·ªìi| R[üè† Home]

                Q --> S[ü§ñ AI t·∫°o Routine]
                S --> R

                subgraph Demo
                T[üéÆ Demo Login]
                T --> O
                end

                style A fill:#e3f2fd
                style R fill:#c8e6c9
                style Q fill:#fff3e0
                style T fill:#f3e5f5
            </div>

            <div class="description">
                <h3>üìù Chi ti·∫øt x√°c th·ª±c</h3>
                <ul>
                    <li><strong>Name:</strong> T·ªëi thi·ªÉu 2 k√Ω t·ª±</li>
                    <li><strong>Phone:</strong> 10 ch·ªØ s·ªë, b·∫Øt ƒë·∫ßu b·∫±ng 0</li>
                    <li><strong>Age:</strong> 1-120 tu·ªïi</li>
                    <li><strong>Demo Account:</strong> Demo User / 0123456789 / 25</li>
                </ul>
            </div>
        </section>

        <!-- Home Section -->
        <section id="home" class="flowchart-section">
            <h2>Lu·ªìng Trang Ch·ªß</h2>
            <div class="mermaid">
                flowchart TD
                A[üè† Home Page Mount] --> B[üì¶ Load Test History]
                B --> C[ü§ñ G·ªçi AI Insights]

                C --> D{AI OK?}
                D -->|‚ùå| E[Empty State]
                D -->|‚úÖ| F[üìä Dashboard Content]

                F --> G[Vision Score]
                F --> H[Trend Analysis]
                F --> I[Recommendations]

                subgraph TodayPlan["üìÖ Today's Plan"]
                J[Load Weekly Routine]
                J --> K[Filter by Today]
                K --> L{C√≥ activities?}
                L -->|‚ùå| M[Rest Day üò¥]
                L -->|‚úÖ| N[Activity Cards]
                end

                N --> O{Click Activity?}
                O -->|Test| P[Navigate Test]
                O -->|Exercise| Q[Exercise Modal]
                O -->|Interactive| R[AI Exercise]

                subgraph Tests["üéØ All Tests"]
                S[Render 6 Test Cards]
                S --> T{Click?}
                T --> U[Navigate Test Page]
                end

                subgraph Tour["üéì Tour Guide"]
                V{First-time?}
                V -->|Yes| W[Auto Tour]
                W --> X[Highlight UI]
                end

                style A fill:#e3f2fd
                style F fill:#c8e6c9
                style P fill:#fff9c4
                style U fill:#fff9c4
            </div>
        </section>

        <!-- Tests Section -->
        <section id="tests" class="flowchart-section">
            <h2>Lu·ªìng Ki·ªÉm Tra Th·ªã L·ª±c</h2>
            <div class="mermaid">
                flowchart TD
                A[üéØ Test Page] --> B[Start Screen]
                B --> C{Click Start?}
                C -->|Yes| D[Initialize Test]

                D --> E[Generate Questions]
                E --> F[Test Screen]

                F --> G{User tr·∫£ l·ªùi}
                G --> H[Record Answer]
                H --> I{C√≤n c√¢u?}

                I -->|Yes| F
                I -->|No| J[Calculate Results]

                J --> K[ü§ñ Generate AI Report]
                K --> L{AI OK?}

                L -->|‚ùå| M[Fallback Report]
                L -->|‚úÖ| N[Full Report]

                M --> O[üíæ Save to Storage]
                N --> O

                O --> P[üì° Sync Backend]
                P --> Q[üî• Update Streak]
                Q --> R[‚úÖ Complete View]

                R --> S{Action?}
                S -->|üìÑ View Report| T[Report Modal]
                S -->|üîÑ Retake| A
                S -->|üì§ Share| U[Share Options]
                S -->|üè† Home| V[Navigate Home]

                style A fill:#e8eaf6
                style R fill:#c8e6c9
                style K fill:#fff3e0
            </div>

            <div class="description">
                <h3>üìã 5 Lo·∫°i Test</h3>
                <ul>
                    <li><strong>Snellen:</strong> Th·ªã l·ª±c - X√°c ƒë·ªãnh ƒë·ªô n√©t (20/20, 20/40...)</li>
                    <li><strong>Ishihara:</strong> M√π m√†u - 20 b·∫£ng m√†u Ishihara</li>
                    <li><strong>Astigmatism:</strong> Lo·∫°n th·ªã - Ph√°t hi·ªán ƒë·ªô cong gi√°c m·∫°c</li>
                    <li><strong>Amsler Grid:</strong> V√µng m·∫°c - Ph√°t hi·ªán tho√°i h√≥a ƒëi·ªÉm v√†ng</li>
                    <li><strong>Duochrome:</strong> K√≠nh - Ki·ªÉm tra ƒë·ªô ch√≠nh x√°c k√≠nh</li>
                </ul>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e8eaf6"></div>
                    <span>B·∫Øt ƒë·∫ßu</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff3e0"></div>
                    <span>AI Processing</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #c8e6c9"></div>
                    <span>Ho√†n th√†nh</span>
                </div>
            </div>
        </section>

        <!-- AI Section -->
        <section id="ai" class="flowchart-section">
            <h2>Lu·ªìng AI Assistant (Eva)</h2>
            <div class="mermaid">
                flowchart TD
                subgraph ChatFlow["üí¨ Text Chat"]
                A1[Click Chat Button] --> B1[Open Modal]
                B1 --> C1[Load History]
                C1 --> D1[User nh·∫≠p message]
                D1 --> E1{API Key?}
                E1 -->|Gemini| F1[Gemini API]
                E1 -->|Workers| G1[Cloudflare AI]
                F1 --> H1[AI Response]
                G1 --> H1
                H1 --> I1[Display + TTS]
                I1 --> D1
                end

                subgraph VoiceFlow["üé§ Voice Chat"]
                A2[Click Voice Button] --> B2[Open Modal]
                B2 --> C2{Browser Support?}
                C2 -->|‚ùå| D2[Unsupported]
                C2 -->|‚úÖ| E2[Init Speech]
                E2 --> F2[User n√≥i]
                F2 --> G2[Speech‚ÜíText]
                G2 --> H2[Send to AI]
                H2 --> I2[AI Response]
                I2 --> J2[Text‚ÜíSpeech]
                J2 --> K2[Eva n√≥i]
                K2 --> F2
                end

                subgraph Context["üß† AI Context"]
                L[System: Dr. Eva]
                M[L·ªãch s·ª≠ chat]
                N[User health data]
                end

                style A1 fill:#c8e6c9
                style A2 fill:#90caf9
                style H1 fill:#f3e5f5
                style I2 fill:#f3e5f5
            </div>

            <div class="description">
                <h3>ü§ñ Eva AI Features</h3>
                <ul>
                    <li><strong>Text Chat:</strong> G√µ text, nh·∫≠n tr·∫£ l·ªùi t·ª´ Gemini/LLAMA 3.1</li>
                    <li><strong>Voice Chat:</strong> N√≥i chuy·ªán b·∫±ng gi·ªçng n√≥i (Web Speech API)</li>
                    <li><strong>Context Aware:</strong> Hi·ªÉu l·ªãch s·ª≠ test v√† s·ª©c kh·ªèe ng∆∞·ªùi d√πng</li>
                    <li><strong>Multilingual:</strong> H·ªó tr·ª£ ti·∫øng Vi·ªát v√† ti·∫øng Anh</li>
                </ul>
            </div>
        </section>

        <!-- Data Section -->
        <section id="data" class="flowchart-section">
            <h2>Lu·ªìng D·ªØ Li·ªáu</h2>
            <div class="mermaid">
                flowchart TD
                subgraph Client["üì± Client Layer"]
                A[localStorage]
                B[React Context]
                C[Components]
                end

                subgraph Services["‚öôÔ∏è Service Layer"]
                D[StorageService]
                E[AIService]
                F[AuthService]
                end

                subgraph Backend["‚òÅÔ∏è Backend Layer"]
                G[Cloudflare Workers]
                H[D1 Database]
                I[Workers AI]
                end

                subgraph External["üåê External APIs"]
                J[Google Gemini]
                K[OpenRouter]
                end

                C --> D
                C --> B

                D --> A
                D --> F
                F --> G
                G --> H

                C --> E
                E --> G
                G --> I

                E --> J
                E --> K

                style A fill:#e3f2fd
                style H fill:#c8e6c9
                style J fill:#fff3e0
                style K fill:#fff3e0
            </div>

            <div class="description">
                <h3>üíæ Storage Keys</h3>
                <ul>
                    <li><strong>test_history_v2:</strong> L·ªãch s·ª≠ t·∫•t c·∫£ b√†i test</li>
                    <li><strong>user_auth_v2:</strong> Th√¥ng tin ƒëƒÉng nh·∫≠p</li>
                    <li><strong>weekly_routine:</strong> L·ªãch tr√¨nh tu·∫ßn t·ª´ AI</li>
                    <li><strong>eva_chat_history:</strong> L·ªãch s·ª≠ chat v·ªõi Eva</li>
                    <li><strong>streak_data:</strong> D·ªØ li·ªáu streak & gamification</li>
                </ul>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin" class="flowchart-section">
            <h2>Lu·ªìng Admin Dashboard</h2>
            <div class="mermaid">
                flowchart TD
                A[üîê Admin Access] --> B{Has Token?}
                B -->|‚ùå| C[Login Page]
                B -->|‚úÖ| D[Dashboard]

                C --> E[Enter Credentials]
                E --> F[API /admin/login]
                F --> G{Success?}
                G -->|‚ùå| H[Error]
                H --> C
                G -->|‚úÖ| I[Save Token]
                I --> D

                D --> J{Select Page}

                J -->|üìä| K[Dashboard]
                J -->|üë•| L[Users]
                J -->|üìã| M[Records]
                J -->|üìà| N[Analytics]
                J -->|‚öôÔ∏è| O[Settings]

                K --> P[API /admin/stats]
                L --> Q[API /admin/users]
                M --> R[API /admin/records]
                N --> S[Charts & Reports]
                O --> T[System Config]

                style D fill:#e8eaf6
                style C fill:#ffcdd2
                style K fill:#c8e6c9
            </div>

            <div class="description">
                <h3>üë®‚Äçüíº Admin Features</h3>
                <ul>
                    <li><strong>Dashboard:</strong> T·ªïng quan s·ªë li·ªáu, recent activity</li>
                    <li><strong>Users:</strong> Qu·∫£n l√Ω ng∆∞·ªùi d√πng, search/filter</li>
                    <li><strong>Records:</strong> Xem t·∫•t c·∫£ test records, AI reports</li>
                    <li><strong>Analytics:</strong> Bi·ªÉu ƒë·ªì, th·ªëng k√™ chi ti·∫øt</li>
                    <li><strong>Settings:</strong> C·∫•u h√¨nh h·ªá th·ªëng, AI settings</li>
                </ul>
            </div>
        </section>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        function showSection(id) {
            // Hide all sections
            document.querySelectorAll('.flowchart-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected section
            document.getElementById(id).classList.add('active');

            // Add active to clicked tab
            event.target.classList.add('active');
        }
    </script>
</body>

</html>