# ğŸ‘ï¸ Vision Coach - Ná»n Táº£ng ChÄƒm SÃ³c Sá»©c Khá»e Máº¯t AI

<div align="center">

![Version](https://img.shields.io/badge/version-2.3.0-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![React](https://img.shields.io/badge/React-19-61dafb.svg)
![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue.svg)
![Cloudflare](https://img.shields.io/badge/Cloudflare-Workers-F38020.svg)
![AI](https://img.shields.io/badge/AI-100%25%20Free-brightgreen.svg)

**á»¨ng dá»¥ng web toÃ n diá»‡n cho kiá»ƒm tra, giÃ¡m sÃ¡t vÃ  tÆ° váº¥n sá»©c khá»e máº¯t Ä‘Æ°á»£c há»— trá»£ bá»Ÿi AI**

ğŸ¯ **100% MIá»„N PHÃ** - KhÃ´ng cáº§n API key  
ğŸš€ **Cloudflare Workers AI** - LLAMA 3.1 8B  
ğŸ‘©â€âš•ï¸ **Dr. Eva** - Tiáº¿n sÄ© NhÃ£n khoa vá»›i 20 nÄƒm kinh nghiá»‡m

[ğŸŒ Demo](https://slht4653.testaivision.pages.dev) â€¢ [ğŸ‘¨â€ğŸ’¼ Admin Dashboard](./admin-standalone.html) â€¢ [ğŸ› BÃ¡o lá»—i](https://github.com/LongNgn204/testaivission/issues)

</div>

---

## ğŸ“‘ Má»¥c Lá»¥c

- [âœ¨ TÃ­nh NÄƒng](#-tÃ­nh-nÄƒng-chÃ­nh)
- [ğŸ—ï¸ Kiáº¿n TrÃºc Há»‡ Thá»‘ng](#ï¸-kiáº¿n-trÃºc-há»‡-thá»‘ng)
- [ğŸ“ Cáº¥u TrÃºc ThÆ° Má»¥c](#-cáº¥u-trÃºc-thÆ°-má»¥c-chi-tiáº¿t)
- [ğŸ”„ Luá»“ng Hoáº¡t Äá»™ng](#-luá»“ng-hoáº¡t-Ä‘á»™ng)
- [ğŸš€ CÃ i Äáº·t](#-cÃ i-Ä‘áº·t-nhanh)
- [ğŸ“š API Endpoints](#-api-endpoints)
- [ğŸ› ï¸ CÃ´ng Nghá»‡](#ï¸-cÃ´ng-nghá»‡)
- [ğŸ”’ Báº£o Máº­t](#-báº£o-máº­t)
- [ğŸ“ˆ Changelog](#-changelog)

---

## âœ¨ TÃ­nh NÄƒng ChÃ­nh

### ğŸ‘ï¸ 5 BÃ i Test Thá»‹ Lá»±c ChuyÃªn Nghiá»‡p

| Test | MÃ´ táº£ | PhÃ¡t hiá»‡n | Thá»i gian |
|------|-------|-----------| ----------|
| **Snellen Chart** | Äo thá»‹ lá»±c vá»›i chá»¯ E xoay ngáº«u nhiÃªn | Cáº­n thá»‹, viá»…n thá»‹ | ~3 phÃºt |
| **Ishihara Plates** | 14 báº£ng mÃ u Ishihara chuáº©n | MÃ¹ mÃ u Ä‘á»-xanh | ~5 phÃºt |
| **Amsler Grid** | LÆ°á»›i kiá»ƒm tra Ä‘iá»ƒm vÃ ng | ThoÃ¡i hÃ³a Ä‘iá»ƒm vÃ ng (AMD) | ~3 phÃºt |
| **Astigmatism Dial** | Biá»ƒu Ä‘á»“ tia xoay cho tá»«ng máº¯t | Loáº¡n thá»‹ | ~3 phÃºt |
| **Duochrome Test** | Báº£ng hai mÃ u Ä‘á»-xanh | Cáº­n thá»‹ / Viá»…n thá»‹ | ~3 phÃºt |

### ğŸ¤– Trá»£ LÃ½ AI - Tiáº¿n SÄ© BÃ¡c SÄ© Eva (100% MIá»„N PHÃ)

| TÃ­nh nÄƒng | MÃ´ táº£ | Chi phÃ­ |
|-----------|-------|---------|
| ğŸ’¬ **Chat vÄƒn báº£n** | Há»i Ä‘Ã¡p y khoa vá»›i 150-300 tá»« chi tiáº¿t | **$0** |
| ğŸ¤ **Chat giá»ng nÃ³i** | Äiá»u khiá»ƒn báº±ng giá»ng nÃ³i | **$0** |
| ğŸ“Š **BÃ¡o cÃ¡o AI** | PhÃ¢n tÃ­ch 400-500 tá»« + 12-15 khuyáº¿n nghá»‹ | **$0** |
| ğŸ“… **Lá»‹ch táº­p hÃ ng tuáº§n** | Routine chÄƒm sÃ³c máº¯t cÃ¡ nhÃ¢n hÃ³a | **$0** |
| ğŸ’¡ **Máº¹o chá»§ Ä‘á»™ng** | Lá»i khuyÃªn 50-70 tá»« cÃ³ cÆ¡ sá»Ÿ khoa há»c | **$0** |
| ğŸ”Š **Äá»c hÆ°á»›ng dáº«n** | TTS cho hÆ°á»›ng dáº«n test | **$0** |

### ğŸ“Š Dashboard & BÃ¡o CÃ¡o

- ğŸ¯ **Äiá»ƒm sá»‘ sá»©c khá»e máº¯t** vá»›i phÃ¢n tÃ­ch 80-120 tá»«
- ğŸ“ˆ **Lá»‹ch sá»­ test** vá»›i so sÃ¡nh tiáº¿n bá»™
- ğŸ“‹ **Lá»‹ch trÃ¬nh chÄƒm sÃ³c** cÃ¡ nhÃ¢n hÃ³a
- ğŸ“„ **Xuáº¥t PDF** bÃ¡o cÃ¡o chi tiáº¿t

---

## ğŸ—ï¸ Kiáº¿n TrÃºc Há»‡ Thá»‘ng

```mermaid
flowchart TB
    subgraph Client["ğŸ–¥ï¸ Frontend (React 19 + TypeScript)"]
        UI["ğŸ¨ UI Components"]
        Pages["ğŸ“„ Pages"]
        Context["ğŸ”„ Context Providers"]
        Services["âš™ï¸ Services"]
        Hooks["ğŸª Custom Hooks"]
    end
    
    subgraph Worker["â˜ï¸ Cloudflare Worker"]
        Router["ğŸ›¤ï¸ API Router (itty-router)"]
        Handlers["ğŸ“¡ Handlers"]
        Prompts["ğŸ§  AI Prompts"]
        WorkerServices["ğŸ’¾ Services"]
    end
    
    subgraph External["ğŸŒ External Services"]
        AI["ğŸ¤– Workers AI (LLAMA 3.1)"]
        D1["ğŸ’¿ D1 Database (SQLite)"]
        WebSpeech["ğŸ¤ Web Speech API"]
        TTS["ğŸ”Š SpeechSynthesis"]
    end
    
    UI --> Services
    Pages --> Context
    Context --> Services
    Services --> Router
    Hooks --> Services
    
    Router --> Handlers
    Handlers --> Prompts
    Handlers --> WorkerServices
    
    WorkerServices --> AI
    WorkerServices --> D1
    
    Client --> WebSpeech
    Client --> TTS
```

---

## ğŸ”„ Luá»“ng Hoáº¡t Äá»™ng

### ğŸ“‹ Quy TrÃ¬nh Tá»•ng Quan

```mermaid
flowchart LR
    A["ğŸ‘¤ NgÆ°á»i dÃ¹ng"] --> B["ğŸ” ÄÄƒng nháº­p"]
    B --> C["ğŸ  Trang chá»§"]
    C --> D{"Chá»n hÃ nh Ä‘á»™ng"}
    
    D --> E["ğŸ‘ï¸ LÃ m Test"]
    D --> F["ğŸ’¬ Chat AI"]
    D --> G["ğŸ“Š Xem Dashboard"]
    D --> H["ğŸ“… Xem Routine"]
    
    E --> I["ğŸ“ Káº¿t quáº£ Test"]
    I --> J["ğŸ¤– AI PhÃ¢n tÃ­ch"]
    J --> K["ğŸ“‹ BÃ¡o cÃ¡o"]
    
    F --> L["ğŸ§  Dr. Eva tráº£ lá»i"]
    G --> M["ğŸ“ˆ Insights AI"]
    H --> N["ğŸ—“ï¸ Lá»‹ch cÃ¡ nhÃ¢n"]
    
    K --> O["ğŸ’¾ LÆ°u & Sync"]
    L --> O
    M --> O
    N --> O
```

### ğŸ” Quy TrÃ¬nh XÃ¡c Thá»±c

```mermaid
sequenceDiagram
    participant U as ğŸ‘¤ User
    participant F as ğŸ–¥ï¸ Frontend
    participant W as â˜ï¸ Worker
    participant D as ğŸ’¿ D1 Database
    
    U->>F: Nháº­p thÃ´ng tin (tÃªn, SÄT, tuá»•i)
    F->>W: POST /api/auth/login
    W->>D: Kiá»ƒm tra/Táº¡o user
    D-->>W: User info
    W-->>F: JWT Token + User data
    F->>F: LÆ°u token vÃ o localStorage
    F-->>U: Chuyá»ƒn Ä‘áº¿n Dashboard
    
    Note over F,W: CÃ¡c request tiáº¿p theo
    F->>W: Request + Authorization: Bearer token
    W->>W: Verify JWT
    W-->>F: Response data
```

### ğŸ§ª Quy TrÃ¬nh LÃ m Test

```mermaid
sequenceDiagram
    participant U as ğŸ‘¤ User
    participant T as ğŸ§ª TestComponent
    participant S as âš™ï¸ TestService
    participant A as ğŸ¤– AIService
    participant W as â˜ï¸ Worker
    
    U->>T: Báº¯t Ä‘áº§u test
    T->>T: Hiá»ƒn thá»‹ hÆ°á»›ng dáº«n + TTS
    
    loop Má»—i cÃ¢u há»i
        T->>U: Hiá»ƒn thá»‹ cÃ¢u há»i
        U->>T: Chá»n Ä‘Ã¡p Ã¡n
        T->>S: Ghi nháº­n káº¿t quáº£
    end
    
    T->>S: TÃ­nh Ä‘iá»ƒm cuá»‘i cÃ¹ng
    S->>A: generateReport(testData)
    A->>W: POST /api/report
    W->>W: AI phÃ¢n tÃ­ch (LLAMA 3.1)
    W-->>A: BÃ¡o cÃ¡o JSON
    A-->>S: AIReport object
    S->>S: LÆ°u localStorage
    S-->>T: Hiá»ƒn thá»‹ bÃ¡o cÃ¡o
    T-->>U: Káº¿t quáº£ + Khuyáº¿n nghá»‹
```

### ğŸ’¬ Quy TrÃ¬nh Chat AI

```mermaid
sequenceDiagram
    participant U as ğŸ‘¤ User
    participant C as ğŸ’¬ ChatInterface
    participant AI as ğŸ¤– AIService
    participant W as â˜ï¸ Worker
    participant LLM as ğŸ§  LLAMA 3.1
    
    U->>C: Nháº­p cÃ¢u há»i
    C->>AI: chat(message, context)
    AI->>W: POST /api/chat
    
    W->>W: Build prompt vá»›i context
    W->>LLM: Generate response
    LLM-->>W: AI response (150-300 tá»«)
    
    W-->>AI: Response JSON
    AI-->>C: Message string
    C-->>U: Hiá»ƒn thá»‹ cÃ¢u tráº£ lá»i
```

---

## ğŸ“ Cáº¥u TrÃºc ThÆ° Má»¥c Chi Tiáº¿t

```
testaivission/
â”‚
â”œâ”€â”€ ğŸ“„ index.html                 # Entry point HTML
â”œâ”€â”€ ğŸ“„ index.tsx                  # React entry point
â”œâ”€â”€ ğŸ“„ index.css                  # Global styles + Tailwind
â”œâ”€â”€ ğŸ“„ App.tsx                    # Main React App component
â”œâ”€â”€ ğŸ“„ types.ts                   # TypeScript type definitions
â”œâ”€â”€ ğŸ“„ manifest.json              # PWA manifest
â”œâ”€â”€ ğŸ“„ sw.js                      # Service Worker
â”œâ”€â”€ ğŸ“„ admin-standalone.html      # Admin Dashboard (standalone)
â”‚
â”œâ”€â”€ ğŸ“ components/                # React UI Components (24 files)
â”‚   â”œâ”€â”€ ğŸ“ ui/                    # Shared UI components
â”‚   â”‚   â”œâ”€â”€ GlassCard.tsx         # Glassmorphism card
â”‚   â”‚   â””â”€â”€ PageShell.tsx         # Page wrapper
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ vision-coach/          # AI Chat components
â”‚   â”‚   â”œâ”€â”€ ChatInterface.tsx     # Text chat vá»›i Dr. Eva
â”‚   â”‚   â””â”€â”€ VoiceInterface.tsx    # Voice chat interface
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ§ª SnellenTest.tsx        # Snellen chart test
â”‚   â”œâ”€â”€ ğŸ§ª ColorBlindTest.tsx     # Ishihara plates test
â”‚   â”œâ”€â”€ ğŸ§ª AmslerGridTest.tsx     # AMD detection test
â”‚   â”œâ”€â”€ ğŸ§ª AstigmatismTest.tsx    # Astigmatism dial test
â”‚   â”œâ”€â”€ ğŸ§ª DuochromeTest.tsx      # Myopia/Hyperopia test
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“Š DashboardContent.tsx   # Dashboard with insights
â”‚   â”œâ”€â”€ ğŸ“Š HealthDashboard.tsx    # Health overview
â”‚   â”œâ”€â”€ ğŸ“‹ ReportDisplayContent.tsx # Report viewer
â”‚   â”œâ”€â”€ ğŸ“‹ AIReportVerifier.tsx   # Report verification
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ¯ Header.tsx             # Navigation header
â”‚   â”œâ”€â”€ ğŸ¯ TestShell.tsx          # Test wrapper component
â”‚   â”œâ”€â”€ ğŸ¯ FeatureSlider.tsx      # Feature carousel
â”‚   â”œâ”€â”€ ğŸ—ºï¸ HospitalLocator.tsx   # Find nearby hospitals
â”‚   â”œâ”€â”€ ğŸ“ TourGuide.tsx          # Onboarding tour
â”‚   â”œâ”€â”€ ğŸ‘¤ UserInfo.tsx           # User profile display
â”‚   â””â”€â”€ ğŸ”’ ProtectedRoute.tsx     # Auth guard
â”‚
â”œâ”€â”€ ğŸ“ pages/                     # Page Components (9 files)
â”‚   â”œâ”€â”€ ğŸ  Home.tsx               # Dashboard chÃ­nh
â”‚   â”œâ”€â”€ ğŸ‘‹ WelcomePage.tsx        # Trang chÃ o má»«ng
â”‚   â”œâ”€â”€ ğŸ” AuthPage.tsx           # ÄÄƒng nháº­p/ÄÄƒng kÃ½
â”‚   â”œâ”€â”€ âš™ï¸ PersonalizedSetupPage.tsx # Thiáº¿t láº­p ban Ä‘áº§u
â”‚   â”œâ”€â”€ ğŸ“Š ProgressPage.tsx       # Tiáº¿n trÃ¬nh & thá»‘ng kÃª
â”‚   â”œâ”€â”€ ğŸ“œ History.tsx            # Lá»‹ch sá»­ test
â”‚   â”œâ”€â”€ ğŸ¥ HealthProfile.tsx      # Há»“ sÆ¡ sá»©c khá»e
â”‚   â”œâ”€â”€ â° RemindersPage.tsx      # Lá»‹ch nháº¯c nhá»Ÿ
â”‚   â””â”€â”€ â„¹ï¸ AboutPage.tsx          # Giá»›i thiá»‡u
â”‚
â”œâ”€â”€ ğŸ“ services/                  # Business Logic (11 files)
â”‚   â”œâ”€â”€ ğŸ¤– aiService.ts           # AI chat, report, routine, tip
â”‚   â”œâ”€â”€ ğŸ’¬ chatbotService.ts      # Chatbot API calls
â”‚   â”œâ”€â”€ ğŸ” authService.ts         # JWT auth & user management
â”‚   â”œâ”€â”€ ğŸ’¾ storageService.ts      # LocalStorage management
â”‚   â”œâ”€â”€ ğŸ”„ syncService.ts         # Backend data sync
â”‚   â”œâ”€â”€ â° reminderService.ts     # Notification reminders
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ‘ï¸ snellenService.ts     # Snellen test logic
â”‚   â”œâ”€â”€ ğŸ¨ colorBlindService.ts   # Colorblind test logic
â”‚   â”œâ”€â”€ ğŸ“ amslerGridService.ts   # Amsler test logic
â”‚   â”œâ”€â”€ ğŸ”„ astigmatismService.ts  # Astigmatism test logic
â”‚   â””â”€â”€ ğŸ”´ğŸŸ¢ duochromeService.ts  # Duochrome test logic
â”‚
â”œâ”€â”€ ğŸ“ context/                   # React Context Providers (6 files)
â”‚   â”œâ”€â”€ ğŸŒ LanguageContext.tsx    # i18n (vi/en)
â”‚   â”œâ”€â”€ ğŸŒ™ ThemeContext.tsx       # Dark/Light mode
â”‚   â”œâ”€â”€ ğŸ‘¤ UserContext.tsx        # User state management
â”‚   â”œâ”€â”€ ğŸ“… RoutineContext.tsx     # Weekly routine state
â”‚   â”œâ”€â”€ ğŸ¤ VoiceControlContext.tsx # Voice permissions
â”‚   â””â”€â”€ ğŸ“ TourGuideContext.tsx   # Onboarding state
â”‚
â”œâ”€â”€ ğŸ“ hooks/                     # Custom React Hooks (3 files)
â”‚   â”œâ”€â”€ ğŸ“Š useDashboardInsights.ts # Dashboard AI insights
â”‚   â”œâ”€â”€ ğŸ“„ usePdfExport.ts        # PDF report export
â”‚   â””â”€â”€ ğŸ¤ useSpeechRecognition.ts # Voice input hook
â”‚
â”œâ”€â”€ ğŸ“ utils/                     # Utility Functions (4 files)
â”‚   â”œâ”€â”€ ğŸ”Š audioUtils.ts          # Audio playback helpers
â”‚   â”œâ”€â”€ ğŸ“¦ dataMigration.ts       # Data migration utilities
â”‚   â”œâ”€â”€ âš™ï¸ envConfig.ts           # Environment config
â”‚   â””â”€â”€ ğŸš€ performanceUtils.ts    # Performance optimizations
â”‚
â”œâ”€â”€ ğŸ“ i18n/                      # Internationalization
â”‚   â””â”€â”€ index.ts                  # Translation strings (vi/en)
â”‚
â”œâ”€â”€ ğŸ“ worker/                    # Cloudflare Worker Backend
â”‚   â”œâ”€â”€ ğŸ“„ wrangler.toml          # Worker config
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ src/
â”‚       â”œâ”€â”€ ğŸ“„ index.ts           # API router & CORS
â”‚       â”œâ”€â”€ ğŸ“„ types.ts           # Backend type definitions
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ handlers/          # API Handlers (9 files)
â”‚       â”‚   â”œâ”€â”€ ğŸ” auth.ts        # Login/Verify/Logout
â”‚       â”‚   â”œâ”€â”€ ğŸ’¬ chat.ts        # AI chat endpoint
â”‚       â”‚   â”œâ”€â”€ ğŸ“Š aiReport.ts    # Report generation
â”‚       â”‚   â”œâ”€â”€ ğŸ“… routine.ts     # Weekly routine
â”‚       â”‚   â”œâ”€â”€ ğŸ’¡ proactiveTip.ts # Health tips
â”‚       â”‚   â”œâ”€â”€ ğŸ“ˆ dashboard.ts   # Dashboard insights
â”‚       â”‚   â”œâ”€â”€ ğŸ”„ sync.ts        # Data sync
â”‚       â”‚   â”œâ”€â”€ ğŸ‘¨â€ğŸ’¼ admin.ts       # Admin API
â”‚       â”‚   â””â”€â”€ ğŸ¤– adminAssistant.ts # Admin AI helper
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ prompts/           # AI Prompt Templates (5 files)
â”‚       â”‚   â”œâ”€â”€ ğŸ’¬ chat.ts        # Dr. Eva chat prompts
â”‚       â”‚   â”œâ”€â”€ ğŸ“Š report.ts      # Report analysis prompts
â”‚       â”‚   â”œâ”€â”€ ğŸ“ˆ dashboard.ts   # Dashboard analysis prompts
â”‚       â”‚   â”œâ”€â”€ ğŸ’¡ proactiveTip.ts # Health tip prompts
â”‚       â”‚   â””â”€â”€ ğŸ“… routine.ts     # Routine generation prompts
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ services/          # Backend Services (3 files)
â”‚       â”‚   â”œâ”€â”€ ğŸ§  gemini.ts      # AI model wrapper (LLAMA 3.1)
â”‚       â”‚   â”œâ”€â”€ ğŸ’¾ database.ts    # D1 database operations
â”‚       â”‚   â””â”€â”€ ğŸ“¦ cache.ts       # Response caching
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“ middleware/        # Middleware (3 files)
â”‚           â”œâ”€â”€ ğŸ” auth.ts        # JWT verification
â”‚           â”œâ”€â”€ ğŸš¦ rateLimit.ts   # Rate limiting
â”‚           â””â”€â”€ ğŸ“ logger.ts      # Request logging
â”‚
â””â”€â”€ ğŸ“ assets/                    # Static Assets
    â”œâ”€â”€ logo.png                  # App logo
    â”œâ”€â”€ dr_eva.png                # Dr. Eva avatar
    â””â”€â”€ vision_tests.png          # Screenshot
```

---

## ï¿½ Code LiÃªn Káº¿t - VÃ­ Dá»¥ Thá»±c Táº¿

### 1ï¸âƒ£ Frontend Component â†’ Service â†’ Worker API

```tsx
// ğŸ“„ components/vision-coach/ChatInterface.tsx
import { chat } from '../../services/aiService';

const ChatInterface = () => {
  const handleSend = async (message: string) => {
    // Gá»i service layer
    const response = await chat(message, lastTestResult, userProfile, language);
    setMessages(prev => [...prev, { role: 'assistant', content: response }]);
  };
};
```

```typescript
// ğŸ“„ services/aiService.ts
import { getEnvConfig } from '../utils/envConfig';

export async function chat(
  message: string,
  lastTestResult: any,
  userProfile: any,
  language: 'vi' | 'en'
): Promise<string> {
  const config = getEnvConfig();
  
  // Gá»i Worker API
  const response = await fetch(`${config.apiUrl}/api/chat`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({ message, lastTestResult, userProfile, language })
  });
  
  const data = await response.json();
  return data.message;
}
```

```typescript
// ğŸ“„ worker/src/handlers/chat.ts
import { createChatPrompt } from '../prompts/chat';
import { generateWithCloudflareAI } from '../services/gemini';

export async function chat(request: IRequest, env: any) {
  const { message, lastTestResult, userProfile, language } = await request.json();
  
  // Sá»­ dá»¥ng prompt template
  const prompt = createChatPrompt(message, lastTestResult, userProfile, language);
  
  // Gá»i AI Model
  const response = await generateWithCloudflareAI(env.AI, prompt);
  
  return new Response(JSON.stringify({ message: response }));
}
```

```typescript
// ğŸ“„ worker/src/prompts/chat.ts
export function createChatPrompt(
  message: string,
  lastTestResult: any,
  userProfile: any,
  language: 'vi' | 'en'
): string {
  return language === 'vi'
    ? `Báº¡n lÃ  TIáº¾N SÄ¨ - BÃC SÄ¨ EVA...
       CÃ‚U Há»I: ${message}`
    : `You are DR. EVA, MD, PhD...
       QUESTION: ${message}`;
}
```

---

### 2ï¸âƒ£ Test Component â†’ Test Service â†’ AI Report

```tsx
// ğŸ“„ components/SnellenTest.tsx
import { generateReport } from '../services/aiService';
import { calculateSnellenScore } from '../services/snellenService';

const SnellenTest = () => {
  const handleTestComplete = async (answers: Answer[]) => {
    // TÃ­nh Ä‘iá»ƒm tá»« test service
    const score = calculateSnellenScore(answers);
    
    // Gá»i AI Ä‘á»ƒ táº¡o bÃ¡o cÃ¡o
    const report = await generateReport('snellen', { score, answers }, language);
    
    // LÆ°u káº¿t quáº£
    saveTestResult({ testType: 'snellen', resultData: { score }, report });
  };
};
```

```typescript
// ğŸ“„ services/snellenService.ts
export function calculateSnellenScore(answers: Answer[]): string {
  const correctCount = answers.filter(a => a.isCorrect).length;
  const acuity = getAcuityFromCorrect(correctCount);
  return acuity; // "20/20", "20/25", etc.
}
```

```typescript
// ğŸ“„ worker/src/handlers/aiReport.ts
import { createReportPrompt, createReportSchema } from '../prompts/report';

export async function generateReport(request: IRequest, env: any) {
  const { testType, testData, history, language } = await request.json();
  
  // Sá»­ dá»¥ng prompt vÃ  schema
  const prompt = createReportPrompt(testType, testData, history, language);
  const schema = createReportSchema();
  
  // Generate vá»›i structured output
  const report = await generateWithCloudflareAI(env.AI, prompt, schema);
  
  return new Response(JSON.stringify(report));
}
```

---

### 3ï¸âƒ£ Context Provider â†’ Hook â†’ Component

```tsx
// ğŸ“„ context/UserContext.tsx
export const UserProvider = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  
  const login = async (name: string, phone: string, age: number) => {
    const response = await authService.login(name, phone, age);
    setUser(response.user);
    setIsAuthenticated(true);
  };
  
  return (
    <UserContext.Provider value={{ user, isAuthenticated, login }}>
      {children}
    </UserContext.Provider>
  );
};
```

```tsx
// ğŸ“„ hooks/useDashboardInsights.ts
import { useUser } from '../context/UserContext';
import { generateDashboardInsights } from '../services/aiService';

export function useDashboardInsights() {
  const { user } = useUser();
  const [insights, setInsights] = useState<DashboardInsights | null>(null);
  
  useEffect(() => {
    if (user) {
      const history = storageService.getTestHistory();
      generateDashboardInsights(history, language).then(setInsights);
    }
  }, [user]);
  
  return insights;
}
```

```tsx
// ğŸ“„ components/DashboardContent.tsx
import { useDashboardInsights } from '../hooks/useDashboardInsights';

const DashboardContent = () => {
  const insights = useDashboardInsights();
  
  return (
    <div>
      <ScoreCard score={insights?.score} rating={insights?.rating} />
      <TrendChart trend={insights?.trend} />
      <ProTip tip={insights?.proTip} />
    </div>
  );
};
```

---

### 4ï¸âƒ£ Worker Router â†’ Handlers â†’ Services â†’ Database

```typescript
// ğŸ“„ worker/src/index.ts (Router)
import { Router } from 'itty-router';
import { chat } from './handlers/chat';
import { generateReport } from './handlers/aiReport';
import { syncHistory } from './handlers/sync';

const router = Router();

router.post('/api/chat', chat);
router.post('/api/report', generateReport);
router.post('/api/sync/history', syncHistory);

export default {
  async fetch(request: Request, env: any) {
    return router.handle(request, env);
  }
};
```

```typescript
// ğŸ“„ worker/src/handlers/sync.ts
import { DatabaseService } from '../services/database';

export async function syncHistory(request: IRequest, env: any) {
  const { history } = await request.json();
  
  // Sá»­ dá»¥ng database service
  const db = new DatabaseService(env.DB);
  
  for (const item of history) {
    await db.saveTestResult({
      user_id: decoded.userId,
      test_type: item.testType,
      test_data: JSON.stringify(item.resultData),
      score: item.score
    });
  }
  
  return new Response(JSON.stringify({ success: true, synced: history.length }));
}
```

```typescript
// ğŸ“„ worker/src/services/database.ts
export class DatabaseService {
  constructor(private db: D1Database) {}
  
  async saveTestResult(data: TestResultInput) {
    const result = await this.db.prepare(`
      INSERT INTO test_results (user_id, test_type, test_data, score, created_at)
      VALUES (?, ?, ?, ?, datetime('now'))
      RETURNING *
    `).bind(data.user_id, data.test_type, data.test_data, data.score).first();
    
    return result;
  }
  
  async getUserTestHistory(userId: string, limit: number) {
    return await this.db.prepare(`
      SELECT * FROM test_results 
      WHERE user_id = ? 
      ORDER BY created_at DESC 
      LIMIT ?
    `).bind(userId, limit).all();
  }
}
```

---

## ï¿½ğŸš€ CÃ i Äáº·t Nhanh

### YÃªu Cáº§u

- âœ… Node.js 18+
- âœ… npm hoáº·c yarn
- âœ… Cloudflare account (miá»…n phÃ­)

### 1ï¸âƒ£ Frontend

```bash
# Clone repository
git clone https://github.com/LongNgn204/testaivission.git
cd testaivission

# CÃ i Ä‘áº·t dependencies
npm install

# Cháº¡y development server
npm run dev

# Build production
npm run build
```

### 2ï¸âƒ£ Backend (Cloudflare Worker)

```bash
# Di chuyá»ƒn vÃ o thÆ° má»¥c worker
cd worker

# CÃ i Ä‘áº·t dependencies
npm install

# Táº¡o D1 database (chá»‰ láº§n Ä‘áº§u)
npx wrangler d1 create vision-coach-db

# Apply migrations
npx wrangler d1 execute vision-coach-db --file=./migrations/0001_init.sql

# Deploy to production
npx wrangler deploy

# Test locally
npx wrangler dev
```

### 3ï¸âƒ£ Environment Variables

**Frontend (`.env`):**
```env
VITE_API_URL=https://vision-coach-worker.stu725114073.workers.dev
```

**Worker (`wrangler.toml`):**
```toml
[vars]
JWT_SECRET = "your-secure-jwt-secret"

[[d1_databases]]
binding = "DB"
database_name = "vision-coach-db"
database_id = "your-database-id"

[ai]
binding = "AI"
```

---

## ğŸ“š API Endpoints

### ğŸ” Authentication

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| POST | `/api/auth/login` | ÄÄƒng nháº­p (name, phone, age) |
| POST | `/api/auth/verify` | XÃ¡c thá»±c JWT token |
| POST | `/api/auth/logout` | ÄÄƒng xuáº¥t |

### ğŸ¤– AI Services (FREE - LLAMA 3.1)

| Method | Endpoint | MÃ´ táº£ | Response |
|--------|----------|-------|----------|
| POST | `/api/chat` | Chat vá»›i Dr. Eva | 150-300 tá»« |
| POST | `/api/report` | Táº¡o bÃ¡o cÃ¡o test | 400-500 tá»« + 12-15 khuyáº¿n nghá»‹ |
| POST | `/api/dashboard` | Dashboard insights | 80-120 tá»« |
| POST | `/api/routine` | Lá»‹ch táº­p cÃ¡ nhÃ¢n | 7-day routine |
| POST | `/api/proactive-tip` | Máº¹o sá»©c khá»e | 50-70 tá»« |

### ğŸ‘¨â€ğŸ’¼ Admin API (Protected)

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| GET | `/api/admin/users` | Danh sÃ¡ch ngÆ°á»i dÃ¹ng |
| GET | `/api/admin/records` | Lá»‹ch sá»­ test |
| GET | `/api/admin/stats` | Thá»‘ng kÃª tá»•ng há»£p |

### ğŸ”„ Data Sync

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| POST | `/api/sync/pull` | Láº¥y dá»¯ liá»‡u tá»« server |
| POST | `/api/sync/history` | Äá»“ng bá»™ lá»‹ch sá»­ test |
| POST | `/api/sync/settings` | Äá»“ng bá»™ cÃ i Ä‘áº·t |

---

## ğŸ› ï¸ CÃ´ng Nghá»‡

### Frontend Stack

| CÃ´ng nghá»‡ | PhiÃªn báº£n | MÃ´ táº£ |
|-----------|-----------|-------|
| React | 19 | UI Framework vá»›i Concurrent Mode |
| TypeScript | 5.0 | Type safety toÃ n bá»™ codebase |
| Tailwind CSS | 3.4 | Utility-first CSS vá»›i dark mode |
| Vite | 6.4 | Lightning-fast build tool |
| React Router | 6 | Client-side routing |
| Lucide Icons | 0.548 | Icon library |

### Backend Stack

| CÃ´ng nghá»‡ | MÃ´ táº£ |
|-----------|-------|
| Cloudflare Workers | Serverless edge functions (0ms cold start) |
| Workers AI | LLAMA 3.1 8B (miá»…n phÃ­ khÃ´ng giá»›i háº¡n) |
| D1 Database | SQLite cloud database (5GB free) |
| itty-router | Lightweight API routing |
| JWT | XÃ¡c thá»±c vá»›i 7 ngÃ y expiry |

### AI Features (v2.3.0)

| TÃ­nh nÄƒng | CÅ© | Má»›i |
|-----------|-----|-----|
| Äá»™ dÃ i chat | 50-80 tá»« | **150-300 tá»«** |
| Report summary | 250-300 tá»« | **400-500 tá»«** |
| Khuyáº¿n nghá»‹ | 8-10 má»¥c | **12-15 má»¥c chi tiáº¿t** |
| Dr. Eva | 15 nÄƒm kinh nghiá»‡m | **20 nÄƒm + Tiáº¿n sÄ©** |
| TiÃªu chuáº©n | CÆ¡ báº£n | **WHO, AAO, AREDS2** |
| NgÃ´n ngá»¯ | CÃ³ pha trá»™n | **Thuáº§n tÃºy 100%** |

---

## ğŸ”’ Báº£o Máº­t

| Feature | MÃ´ táº£ | Status |
|---------|-------|--------|
| ğŸ” **JWT Auth** | Token expiry 7 ngÃ y | âœ… |
| ğŸ›¡ï¸ **CSRF Protection** | Origin validation | âœ… |
| ğŸš« **Rate Limiting** | 60 requests/minute | âœ… |
| ğŸŒ **CORS** | Whitelist domains | âœ… |
| ğŸ”’ **XSS Prevention** | HTML escaping | âœ… |
| ğŸ“ **Input Sanitization** | TTS text sanitization | âœ… |

---

## ğŸ“ˆ Changelog

### v2.3.0 (December 2024) â­ CURRENT

#### ğŸ§  AI Training Upgrade
- âœ… Dr. Eva nÃ¢ng cáº¥p lÃªn **Tiáº¿n sÄ© - BÃ¡c sÄ©** vá»›i 20 nÄƒm kinh nghiá»‡m
- âœ… Kiáº¿n thá»©c y khoa chuáº©n quá»‘c táº¿: **WHO, AAO, AREDS2**
- âœ… CÃ¢u tráº£ lá»i chi tiáº¿t hÆ¡n: **150-300 tá»«**
- âœ… BÃ¡o cÃ¡o chuyÃªn sÃ¢u: **400-500 tá»« + 12-15 khuyáº¿n nghá»‹**
- âœ… NgÃ´n ngá»¯ thuáº§n tÃºy **100%** (khÃ´ng pha trá»™n)
- âœ… Cáº¥u trÃºc chuáº©n bÃ¡c sÄ©: ÄÃ¡nh giÃ¡ â†’ PhÃ¢n tÃ­ch â†’ Khuyáº¿n nghá»‹ â†’ TiÃªn lÆ°á»£ng

### v2.2.0 (December 2024)

#### ğŸ” Security Fixes
- âœ… Fixed XSS vulnerability in Admin Dashboard
- âœ… Added admin authentication
- âœ… Implemented CSRF protection

#### ğŸ› Bug Fixes
- âœ… Fixed localStorage key mismatch
- âœ… Fixed password validation

### v2.1.0 (December 2024)

#### ğŸ†• New Features
- ğŸ¤ Voice Chat miá»…n phÃ­ (Web Speech API)
- ğŸ“Š Admin Dashboard vá»›i D1 database
- ğŸ§  Enhanced AI vá»›i kiáº¿n thá»©c nhÃ£n khoa

---

## ğŸ“ License

MIT License - Xem file [LICENSE](./LICENSE)

---

## ğŸ‘¨â€ğŸ’» TÃ¡c Giáº£

**Long Nguyá»…n**

- GitHub: [@LongNgn204](https://github.com/LongNgn204)
- Project: [testaivission](https://github.com/LongNgn204/testaivission)

---

<div align="center">

Táº¡o vá»›i â¤ï¸ cho sá»©c khá»e Ä‘Ã´i máº¯t cá»§a báº¡n

**Last Updated**: December 2024  
**Version**: 2.3.0

</div>
